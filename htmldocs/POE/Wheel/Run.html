<HTML>
<HEAD>
<TITLE><A HREF=/docs/POE/Wheel/Run.html>POE::Wheel::Run</A> - event driven fork/exec with added value</TITLE>
<LINK REV="made" HREF="mailto:">
</HEAD>

<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR><TD WIDTH="30">
<img HSPACE="0" VSPACE="0" border="0" src="/images/L-circle.jpg" align="left" alt="" width="30" height="60">
</TD><TD ALIGN="Center" WIDTH=100% BGCOLOR="#000000">
<STRONG><font color="#FFFFFF" size="5"><A HREF=/docs/POE/Wheel/Run.html>POE::Wheel::Run</A> - event driven fork/exec with added value</font></STRONG></TD><TD>
<img HSPACE="0" VSPACE="0" border="0" src="/images/R-circle.jpg" align="right" alt="" width="30" height="60">
</TD></TR></TABLE>

<A NAME="__index__"></A>
<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#name">NAME</A></LI>
	<LI><A HREF="#synopsis">SYNOPSIS</A></LI>
	<LI><A HREF="#description">DESCRIPTION</A></LI>
	<LI><A HREF="#public methods">PUBLIC METHODS</A></LI>
	<LI><A HREF="#events and parameters">EVENTS AND PARAMETERS</A></LI>
	<LI><A HREF="#see also">SEE ALSO</A></LI>
	<LI><A HREF="#bugs">BUGS</A></LI>
	<LI><A HREF="#authors & copyrights">AUTHORS &amp; COPYRIGHTS</A></LI>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="name">NAME</A></H1>
<P><A HREF=/docs/POE/Wheel/Run.html>POE::Wheel::Run</A> - event driven fork/exec with added value</P>
<P>
<HR>
<H1><A NAME="synopsis">SYNOPSIS</A></H1>
<PRE>
  # Program may be scalar or \@array.
  $program = '/usr/bin/cat -';
  $program = [ '/usr/bin/cat', '-' ];</PRE>
<PRE>
  $wheel = <A HREF=/docs/POE/Wheel/Run.html>POE::Wheel::Run</A>-&gt;new(
    Program    =&gt; $program,
    Priority   =&gt; +5,                 # Adjust priority.  May need to be root.
    User       =&gt; getpwnam('nobody'), # Adjust UID. May need to be root.
    Group      =&gt; getgrnam('nobody'), # Adjust GID. May need to be root.
    ErrorEvent =&gt; 'oops',             # Event to emit on errors.</PRE>
<PRE>
    StdinEvent  =&gt; 'stdin',  # Event to emit when stdin is flushed to child.
    StdoutEvent =&gt; 'stdout', # Event to emit with child stdout information.
    StderrEvent =&gt; 'stderr', # Event to emit with child stderr information.</PRE>
<PRE>
    # Identify the child process' I/O type.
    Filter =&gt; <A HREF=/docs/POE/Filter/Line.html>POE::Filter::Line</A>-&gt;new(), # Or some other filter.</PRE>
<PRE>
    # May also specify filters per handle.
    StdinFilter  =&gt; <A HREF=/docs/POE/Filter/Line.html>POE::Filter::Line</A>-&gt;new(),   # Child accepts input as lines.
    StdoutFilter =&gt; <A HREF=/docs/POE/Filter/Stream.html>POE::Filter::Stream</A>-&gt;new(), # Child output is a stream.
    StderrFilter =&gt; <A HREF=/docs/POE/Filter/Line.html>POE::Filter::Line</A>-&gt;new(),   # Child errors are lines.
  );</PRE>
<PRE>
  print &quot;Unique wheel ID is  : &quot;, $wheel-&gt;ID;
  print &quot;Wheel's child PID is: &quot;, $wheel-&gt;PID;</PRE>
<PRE>
  # Send something to the child's STDIN.
  $wheel-&gt;put( 'input for the child' );</PRE>
<P>
<HR>
<H1><A NAME="description">DESCRIPTION</A></H1>
<P>Wheel::Run spawns child processes and establishes non-blocking, event
based communication with them.</P>
<P>
<HR>
<H1><A NAME="public methods">PUBLIC METHODS</A></H1>
<DL>
<DT><STRONG><A NAME="item_new_LOTS_OF_STUFF">new LOTS_OF_STUFF</A></STRONG><BR>
<DD>
<CODE>new()</CODE> creates a new Run wheel.  If successful, the new wheel
represents a child process and the input, output and error pipes that
speak with it.
<P><CODE>new()</CODE> accepts lots of stuff.  Each parameter is name/value pair.</P>
<DL>
<DT><STRONG><A NAME="item_Conduit">Conduit</A></STRONG><BR>
<DD>
<A HREF="#item_Conduit"><CODE>Conduit</CODE></A> describes how Wheel::Run should talk with the child
process.  It may either be 'pipe' (the default), or 'pty'.
<P>Pty conduits require the IO::Pty module.</P>
<P></P>
<DT><STRONG><A NAME="item_ErrorEvent">ErrorEvent</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_StdinEvent">StdinEvent</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_StdoutEvent">StdoutEvent</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_StderrEvent">StderrEvent</A></STRONG><BR>
<DD>
<A HREF="#item_ErrorEvent"><CODE>ErrorEvent</CODE></A> contains the name of an event to emit if something
fails.  It's optional, and if omitted, it won't emit any errors.
<P>Wheel::Run requires at least one of the following three events:</P>
<P><A HREF="#item_StdinEvent"><CODE>StdinEvent</CODE></A> contains the name of an event that Wheel::Run emits
whenever all its output has been flushed to the child process' STDIN
handle.</P>
<P><A HREF="#item_StdoutEvent"><CODE>StdoutEvent</CODE></A> and <A HREF="#item_StderrEvent"><CODE>StderrEvent</CODE></A> contain names of events that
Wheel::Run emits whenever the child process writes something to its
STDOUT or STDERR handles, respectively.</P>
<P></P>
<DT><STRONG><A NAME="item_Filter">Filter</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_StdinFilter">StdinFilter</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_StdoutFilter">StdoutFilter</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_StderrFilter">StderrFilter</A></STRONG><BR>
<DD>
<A HREF="#item_Filter"><CODE>Filter</CODE></A> contains a reference to a <A HREF=/docs/POE/Filter.html>POE::Filter</A> class that describes
how the child process performs input and output.  <A HREF="#item_Filter"><CODE>Filter</CODE></A> will be
used to describe the child's stdin, stdout and stderr.
<P><A HREF="#item_StdinFilter"><CODE>StdinFilter</CODE></A>, <A HREF="#item_StdoutFilter"><CODE>StdoutFilter</CODE></A> and <A HREF="#item_StderrFilter"><CODE>StderrFilter</CODE></A> can be used
instead of <A HREF="#item_Filter"><CODE>Filter</CODE></A> to set different filters for each handle.</P>
<P></P>
<DT><STRONG><A NAME="item_Group">Group</A></STRONG><BR>
<DD>
<A HREF="#item_Group"><CODE>Group</CODE></A> contains a numerical group ID that the child process should
run at.  This may not be meaningful on systems that have no concept of
group IDs.  The current process may need to run as root in order to
change group IDs.  Mileage varies considerably.
<P></P>
<DT><STRONG><A NAME="item_Priority">Priority</A></STRONG><BR>
<DD>
<A HREF="#item_Priority"><CODE>Priority</CODE></A> contains an offset from the current process's priority.
The child will be executed at the current priority plus the offset.
The priority offset may be negative, but the current process may need
to be running as root for that to work.
<P></P>
<DT><STRONG><A NAME="item_Program">Program</A></STRONG><BR>
<DD>
<A HREF="#item_Program"><CODE>Program</CODE></A> is the program to <CODE>exec()</CODE> once pipes and fork have been set
up.  <A HREF="#item_Program"><CODE>Program</CODE></A> can contain either a scalar or an array reference, and
that form will tell Wheel::Run how to <CODE>exec()</CODE> the program.
<P>If <A HREF="#item_Program"><CODE>Program</CODE></A> holds a scalar, the child will be executed as
exec($program).  <CODE>exec()</CODE> may pass <A HREF="#item_Program"><CODE>Program</CODE></A> through a shell to expand
metacharacters.</P>
<P>If <A HREF="#item_Program"><CODE>Program</CODE></A> holds an array reference, the child will be executed as
exec(@$program).  This form doesn't get passed through a shell.</P>
<P><EM>perlfunc</EM> has more information about <CODE>exec()</CODE> and the different ways
to call it.</P>
<P></P></DL>
<DT><STRONG><A NAME="item_event_EVENT_TYPE_%3D%3E_EVENT_NAME%2C_%2E%2E%2E">event EVENT_TYPE =&gt; EVENT_NAME, ...</A></STRONG><BR>
<DD>
<CODE>event()</CODE> changes the event that Wheel::Run emits when a certain type of
event occurs.  <CODE>EVENT_TYPE</CODE> may be one of the event parameters in
Wheel::Run's constructor.
<PRE>
  $wheel-&gt;event( StdinEvent  =&gt; 'new-stdin-event',
                 StdoutEvent =&gt; 'new-stdout-event',
               );</PRE>
<P></P>
<DT><STRONG><A NAME="item_put">put LIST</A></STRONG><BR>
<DD>
<A HREF="#item_put"><CODE>put()</CODE></A> queues a LIST of different inputs for the child process.  They
will be flushed asynchronously once the current state returns.  Each
item in the LIST is processed according to the <A HREF="#item_StdinFilter"><CODE>StdinFilter</CODE></A>.
<P></P>
<DT><STRONG><A NAME="item_set_filter_FILTER_REFERENCE">set_filter FILTER_REFERENCE</A></STRONG><BR>
<DD>
Set <A HREF="#item_StdinFilter"><CODE>StdinFilter</CODE></A>, <A HREF="#item_StdoutFilter"><CODE>StdoutFilter</CODE></A>, and <A HREF="#item_StderrFilter"><CODE>StderrFilter</CODE></A> all at once.
Not yet implemented.
<P></P>
<DT><STRONG><A NAME="item_set_stdin_filter_FILTER_REFERENCE">set_stdin_filter FILTER_REFERENCE</A></STRONG><BR>
<DD>
Set <A HREF="#item_StdinFilter"><CODE>StdinFilter</CODE></A> to something else.  Not yet implemented.
<P></P>
<DT><STRONG><A NAME="item_set_stdout_filter_FILTER_REFERENCE">set_stdout_filter FILTER_REFERENCE</A></STRONG><BR>
<DD>
Set <A HREF="#item_StdoutFilter"><CODE>StdoutFilter</CODE></A> to something else.  Not yet implemented.
<P></P>
<DT><STRONG><A NAME="item_set_stderr_filter_FILTER_REFERENCE">set_stderr_filter FILTER_REFERENCE</A></STRONG><BR>
<DD>
Set <A HREF="#item_StderrFilter"><CODE>StderrFilter</CODE></A> to something else.  Not yet implemented.
<P></P>
<DT><STRONG><A NAME="item_ID">ID</A></STRONG><BR>
<DD>
Returns the wheel's unique ID, which is not the same as the child
process' ID.  Every event generated by Wheel::Run includes a wheel ID
so that it can be matched up with its generator.  This lets a single
session manage several wheels without becoming confused about which
one generated what event.
<P></P>
<DT><STRONG><A NAME="item_PID">PID</A></STRONG><BR>
<DD>
Returns the child process' ID.  It's useful for matching up to SIGCHLD
events, which include child process IDs as well, so that wheels can be
destroyed properly when children exit.
<P></P></DL>
<P>
<HR>
<H1><A NAME="events and parameters">EVENTS AND PARAMETERS</A></H1>
<DL>
<DT><STRONG>ErrorEvent</STRONG><BR>
<DD>
ErrorEvent contains the name on an event that Wheel::Run emits
whenever an error occurs.  Every error event comes with four
parameters:
<P><CODE>ARG0</CODE> contains the name of the operation that failed.  It may be
'read' or 'write' or 'fork' or 'exec' or something.  The actual values
aren't yet defined.  Note: This is not necessarily a function name.</P>
<P><CODE>ARG1</CODE> and <CODE>ARG2</CODE> hold numeric and string values for <CODE>$!</CODE>,
respectively.</P>
<P><CODE>ARG3</CODE> contains the wheel's unique ID.</P>
<P>A sample error event handler:</P>
<PRE>
  sub error_state {
    my ($operation, $errnum, $errstr, $wheel_id) = @_[ARG0..ARG3];
    warn &quot;Wheel $wheel_id generated $operation error $errnum: $errstr\n&quot;;
  }</PRE>
<P></P>
<DT><STRONG>StdinEvent</STRONG><BR>
<DD>
StdinEvent contains the name of an event that Wheel::Run emits
whenever everything queued by its <A HREF="#item_put"><CODE>put()</CODE></A> method has been flushed to the
child's STDIN handle.
<P>StdinEvent's <CODE>ARG0</CODE> parameter contains its wheel's unique ID.</P>
<P></P>
<DT><STRONG>StdoutEvent</STRONG><BR>
<DD>
<DT><STRONG>StderrEvent</STRONG><BR>
<DD>
StdoutEvent and StderrEvent contain names for events that Wheel::Run
emits whenever the child process makes output.  StdoutEvent contains
information the child wrote to its STDOUT handle, and StderrEvent
includes whatever arrived from the child's STDERR handle.
<P>Both of these events come with two parameters.  <CODE>ARG0</CODE> contains the
information that the child wrote.  <CODE>ARG1</CODE> holds the wheel's unique
ID.</P>
<PRE>
  sub stdout_state {
    my ($heap, $input, $wheel_id) = @_[HEAP, ARG0, ARG1];
    print &quot;Child process in wheel $wheel_id wrote to STDOUT: $input\n&quot;;
  }</PRE>
<PRE>
  sub stderr_state {
    my ($heap, $input, $wheel_id) = @_[HEAP, ARG0, ARG1];
    print &quot;Child process in wheel $wheel_id wrote to STDERR: $input\n&quot;;
  }</PRE>
<P></P></DL>
<P>
<HR>
<H1><A NAME="see also">SEE ALSO</A></H1>
<P><A HREF=/docs/POE/Wheel.html>POE::Wheel</A>.</P>
<P>The <A HREF=/docs/POE.html#see also>SEE ALSO section in <EM>POE</EM></A> contains a table of contents covering
the entire POE distribution.</P>
<P>
<HR>
<H1><A NAME="bugs">BUGS</A></H1>
<P>Wheel::Run's constructor doesn't emit proper events when it fails.
Instead, it just dies, carps or croaks.</P>
<P>Filter changing hasn't been implemented yet.  Let the author know if
it's needed.  Better yet, patch the file based on the code in
Wheel::ReadWrite.</P>
<P>Wheel::Run generates SIGCHLD.  This may eventually cause Perl to
segfault.  Bleah.</P>
<P>Priority is a delta; there's no way to set it directly to some value.</P>
<P>User must be specified by UID.  It would be nice to support login
names.</P>
<P>Group must be specified by GID.  It would be nice to support group
names.</P>
<P>ActiveState Perl is not going to like this module one bit.</P>
<P>
<HR>
<H1><A NAME="authors & copyrights">AUTHORS &amp; COPYRIGHTS</A></H1>
<P>Please <A HREF=/docs/POE.html>see <EM>POE</EM></A> for more information about authors and contributors.</P>

</BODY>

</HTML>
